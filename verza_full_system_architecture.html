<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verza Ecosystem Architecture</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #f8f9fa;
            --layer-bg: #ffffff;
            --layer-border: #e9ecef;
            --box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --primary-blue: #0ea5e9;
            --secondary-indigo: #6366f1;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --danger-red: #ef4444;
            --dark-gray: #374151;
            --light-gray: #9ca3af;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--dark-gray);
            margin: 0;
            padding: 20px;
            overflow-x: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 { margin: 0; color: #1e293b; }
        .header p { color: #64748b; margin-top: 5px; }

        /* Grid Layout */
        .architecture-grid {
            display: grid;
            grid-template-rows: auto auto auto auto;
            gap: 40px;
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            padding-bottom: 50px;
        }

        /* Layers */
        .layer {
            background: var(--layer-bg);
            border: 1px solid var(--layer-border);
            border-radius: 16px;
            padding: 20px 30px;
            position: relative;
            box-shadow: var(--box-shadow);
        }

        .layer-label {
            position: absolute;
            top: -12px;
            left: 20px;
            background: #1e293b;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 10;
        }

        .layer-content {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            padding-top: 10px;
        }

        /* Components */
        .component {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            width: 200px;
            text-align: center;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
            z-index: 2;
        }

        .component:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            border-color: var(--primary-blue);
        }

        .component-icon {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: block;
        }

        .component-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .component-desc {
            font-size: 0.75rem;
            color: #64748b;
            line-height: 1.3;
        }

        .component-tags {
            margin-top: 8px;
            display: flex;
            gap: 4px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: #f1f5f9;
            color: #475569;
        }

        /* Sub-groups within layers */
        .sub-group {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 15px;
            background: #f8fafc;
            display: flex;
            gap: 15px;
            position: relative;
        }
        .sub-group-label {
            position: absolute;
            bottom: -10px;
            right: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            color: #94a3b8;
            background: #f8fafc;
            padding: 0 5px;
        }

        /* Specific Colors */
        .c-blue .component-icon { color: var(--primary-blue); }
        .c-indigo .component-icon { color: var(--secondary-indigo); }
        .c-green .component-icon { color: var(--success-green); }
        .c-orange .component-icon { color: var(--warning-orange); }
        .c-red .component-icon { color: var(--danger-red); }
        .c-purple .component-icon { color: #8b5cf6; }
        .c-dark .component-icon { color: #334155; }

        /* Connections Layer */
        .connections-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .connection-path {
            stroke: #cbd5e1;
            stroke-width: 2;
            fill: none;
            transition: stroke 0.3s;
        }
        
        .connection-path.active {
            stroke: var(--primary-blue);
            stroke-dasharray: 5,5;
            animation: flow 1s linear infinite;
        }

        @keyframes flow {
            to { stroke-dashoffset: -10; }
        }

    </style>
</head>
<body>

    <div class="header">
        <h1>Verza Ecosystem Architecture</h1>
        <p>End-to-End System View: Admins, Institutions & Users</p>
    </div>

    <div class="diagram-container architecture-grid">
        
        <!-- Layer 1: Actors & Clients -->
        <div class="layer" id="layer-client">
            <div class="layer-label">1. Actors & Access Layer</div>
            <div class="layer-content">
                
                <div class="component c-dark" id="actor-admin">
                    <i class="fa-solid fa-user-shield component-icon"></i>
                    <div class="component-title">System Admins</div>
                    <div class="component-desc">Platform Management</div>
                    <div class="component-tags"><span class="tag">Internal</span></div>
                </div>

                <div class="component c-indigo" id="client-institution">
                    <i class="fa-solid fa-building-columns component-icon"></i>
                    <div class="component-title">Institutions</div>
                    <div class="component-desc">Verifiers & Partners</div>
                    <div class="component-tags"><span class="tag">API Keys</span><span class="tag">Dashboard</span></div>
                </div>

                <div class="component c-blue" id="client-user">
                    <i class="fa-solid fa-user component-icon"></i>
                    <div class="component-title">End Users</div>
                    <div class="component-desc">Identity Holders</div>
                    <div class="component-tags"><span class="tag">Web App</span></div>
                </div>

                <div class="component c-blue" id="client-mobile">
                    <i class="fa-solid fa-mobile-screen component-icon"></i>
                    <div class="component-title">Mobile SDK</div>
                    <div class="component-desc">Native ID Capture</div>
                    <div class="component-tags"><span class="tag">iOS/Android</span></div>
                </div>
            </div>
        </div>

        <!-- Layer 2: Application / Services Layer -->
        <div class="layer" id="layer-app">
            <div class="layer-label">2. Application Services Layer</div>
            <div class="layer-content">
                
                <!-- Main Backend Group -->
                <div class="sub-group">
                    <div class="sub-group-label">Verza Core</div>
                    <div class="component c-blue" id="svc-backend">
                        <i class="fa-brands fa-golang component-icon"></i>
                        <div class="component-title">Verza Backend</div>
                        <div class="component-desc">Monolithic API, Business Logic, RBAC</div>
                        <div class="component-tags"><span class="tag">Go</span><span class="tag">Mux</span></div>
                    </div>
                    <div class="component c-purple" id="svc-bridge">
                        <i class="fa-solid fa-bridge component-icon"></i>
                        <div class="component-title">Chain Bridge</div>
                        <div class="component-desc">Event Listener & Tx Submitter</div>
                        <div class="component-tags"><span class="tag">Go</span><span class="tag">EVM/Midnight</span></div>
                    </div>
                </div>

                <!-- Identity Platform Group -->
                <div class="sub-group">
                    <div class="sub-group-label">Identity Platform</div>
                    <div class="component c-blue" id="svc-gateway">
                        <i class="fa-solid fa-door-open component-icon"></i>
                        <div class="component-title">Identity Gateway</div>
                        <div class="component-desc">Public Edge API for KYC/Docs</div>
                        <div class="component-tags"><span class="tag">Go</span><span class="tag">Rate Limit</span></div>
                    </div>
                    <div class="component c-blue" id="svc-orchestrator">
                        <i class="fa-solid fa-arrows-split-up-and-left component-icon"></i>
                        <div class="component-title">Orchestrator</div>
                        <div class="component-desc">Workflow State Machine</div>
                        <div class="component-tags"><span class="tag">Go</span><span class="tag">Workers</span></div>
                    </div>
                    <div class="component c-orange" id="svc-inference">
                        <i class="fa-brands fa-python component-icon"></i>
                        <div class="component-title">Inference Engine</div>
                        <div class="component-desc">CV/ML Liveness Checks</div>
                        <div class="component-tags"><span class="tag">Python</span><span class="tag">PyTorch</span></div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Layer 3: Data & Infrastructure Layer -->
        <div class="layer" id="layer-data">
            <div class="layer-label">3. Data & Storage Layer</div>
            <div class="layer-content">
                <div class="component c-indigo" id="db-core">
                    <i class="fa-solid fa-database component-icon"></i>
                    <div class="component-title">Core DB</div>
                    <div class="component-desc">Users, Partners, Audit Logs</div>
                    <div class="component-tags"><span class="tag">PostgreSQL</span></div>
                </div>
                <div class="component c-indigo" id="db-identity">
                    <i class="fa-solid fa-database component-icon"></i>
                    <div class="component-title">Identity DB</div>
                    <div class="component-desc">Session States, Verification Logs</div>
                    <div class="component-tags"><span class="tag">PostgreSQL</span></div>
                </div>
                <div class="component c-orange" id="store-s3">
                    <i class="fa-brands fa-aws component-icon"></i>
                    <div class="component-title">Object Storage</div>
                    <div class="component-desc">Encrypted ID Documents</div>
                    <div class="component-tags"><span class="tag">S3/MinIO</span></div>
                </div>
                <div class="component c-green" id="store-ipfs">
                    <i class="fa-solid fa-cube component-icon"></i>
                    <div class="component-title">IPFS</div>
                    <div class="component-desc">Decentralized Metadata Storage</div>
                    <div class="component-tags"><span class="tag">Pinata/Kubo</span></div>
                </div>
            </div>
        </div>

        <!-- Layer 4: Blockchain & External Layer -->
        <div class="layer" id="layer-web3">
            <div class="layer-label">4. Blockchain & Integrations Layer</div>
            <div class="layer-content">
                <div class="sub-group" style="background: #f0fdf4; border-color: #86efac;">
                    <div class="sub-group-label">On-Chain</div>
                    <div class="component c-green" id="chain-midnight">
                        <i class="fa-solid fa-shield-halved component-icon"></i>
                        <div class="component-title">Midnight Network</div>
                        <div class="component-desc">Privacy-Preserving Contracts</div>
                        <div class="component-tags"><span class="tag">ZK Snarks</span><span class="tag">Compact</span></div>
                    </div>
                    <div class="component c-blue" id="chain-evm">
                        <i class="fa-brands fa-ethereum component-icon"></i>
                        <div class="component-title">EVM / Cardano</div>
                        <div class="component-desc">Public Registry & Escrow</div>
                        <div class="component-tags"><span class="tag">Solidity</span><span class="tag">Plutus</span></div>
                    </div>
                </div>

                <div class="sub-group" style="background: #fefce8; border-color: #fde047;">
                    <div class="sub-group-label">3rd Party</div>
                    <div class="component c-purple" id="ext-stripe">
                        <i class="fa-brands fa-stripe component-icon"></i>
                        <div class="component-title">Stripe</div>
                        <div class="component-desc">Fiat Payments & Payouts</div>
                    </div>
                    <div class="component c-red" id="ext-smtp">
                        <i class="fa-solid fa-envelope component-icon"></i>
                        <div class="component-title">SMTP / SMS</div>
                        <div class="component-desc">Notifications & OTP</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SVG Container for Connectors -->
        <svg class="connections-svg">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#cbd5e1" />
                </marker>
                 <marker id="arrowhead-active" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#0ea5e9" />
                </marker>
            </defs>
        </svg>

    </div>

    <script>
        function drawConnector(startId, endId, type = 'normal') {
            const start = document.getElementById(startId);
            const end = document.getElementById(endId);
            const svg = document.querySelector('.connections-svg');

            if (!start || !end) return;

            const startRect = start.getBoundingClientRect();
            const endRect = end.getBoundingClientRect();
            const containerRect = document.querySelector('.diagram-container').getBoundingClientRect();

            const x1 = startRect.left + startRect.width / 2 - containerRect.left;
            const y1 = startRect.bottom - containerRect.top; // Bottom of start
            const x2 = endRect.left + endRect.width / 2 - containerRect.left;
            const y2 = endRect.top - containerRect.top;    // Top of end

            // Create Path
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            
            // Bezier Curve
            const controlY1 = y1 + 50;
            const controlY2 = y2 - 50;
            
            const d = `M ${x1} ${y1} C ${x1} ${controlY1}, ${x2} ${controlY2}, ${x2} ${y2}`;

            path.setAttribute("d", d);
            path.setAttribute("class", "connection-path");
            path.setAttribute("marker-end", "url(#arrowhead)");
            
            if (type === 'active') {
                path.classList.add('active');
                path.setAttribute("marker-end", "url(#arrowhead-active)");
            }

            svg.appendChild(path);
        }

        function drawSideConnector(startId, endId) {
            const start = document.getElementById(startId);
            const end = document.getElementById(endId);
            const svg = document.querySelector('.connections-svg');

            if (!start || !end) return;

            const startRect = start.getBoundingClientRect();
            const endRect = end.getBoundingClientRect();
            const containerRect = document.querySelector('.diagram-container').getBoundingClientRect();

            const x1 = startRect.right - containerRect.left;
            const y1 = startRect.top + startRect.height / 2 - containerRect.top;
            const x2 = endRect.left - containerRect.left;
            const y2 = endRect.top + endRect.height / 2 - containerRect.top;

             const d = `M ${x1} ${y1} L ${x2} ${y2}`;
             
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", d);
            path.setAttribute("class", "connection-path");
            path.setAttribute("marker-end", "url(#arrowhead)");
            svg.appendChild(path);
        }

        function initDiagram() {
            document.querySelector('.connections-svg').innerHTML = `
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#cbd5e1" />
                </marker>
                 <marker id="arrowhead-active" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#0ea5e9" />
                </marker>
            </defs>`;

            // Client -> App
            drawConnector('actor-admin', 'svc-backend');
            drawConnector('client-institution', 'svc-backend');
            drawConnector('client-user', 'svc-backend', 'active');
            drawConnector('client-mobile', 'svc-gateway', 'active');

            // App Internal
            drawSideConnector('svc-gateway', 'svc-orchestrator');
            drawSideConnector('svc-orchestrator', 'svc-inference');
            drawSideConnector('svc-backend', 'svc-bridge');

            // App -> Data
            drawConnector('svc-backend', 'db-core');
            drawConnector('svc-orchestrator', 'db-identity');
            drawConnector('svc-gateway', 'store-s3');
            drawConnector('svc-backend', 'store-ipfs');

            // App -> Blockchain/External
            drawConnector('svc-bridge', 'chain-midnight');
            drawConnector('svc-bridge', 'chain-evm');
            drawConnector('svc-backend', 'ext-stripe');
            drawConnector('svc-backend', 'ext-smtp');
        }

        window.onload = initDiagram;
        window.onresize = initDiagram;

    </script>
</body>
</html>